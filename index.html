<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://pl28633470.effectivegatecpm.com/48/59/08/4859083f886c1a09ed9a86ac9d282b9b.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn Pro Max - Professional Rewards</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6c5ce7; --bg: #f4f7f6; --wa: #25d366; --yt: #ff0000; --gold: #ff9f43; --danger: #ff4757; --success: #2ecc71; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--bg); color: #2d3436; overflow-x: hidden; }
        
        .page { display: none; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Header & Cards */
        .header { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; padding: 30px 20px; border-radius: 0 0 35px 35px; text-align: center; }
        .bal-row { display: flex; gap: 10px; margin-top: 15px; }
        .bal-box { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 18px; flex: 1; font-weight: 600; border: 1px solid rgba(255,255,255,0.3); font-size: 13px; }

        .auth-card { max-width:450px; margin: 20px auto; background:white; padding:25px; border-radius:25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align:center; border: 1px solid #eee; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px 0; }
        .card { background: white; padding: 20px 10px; border-radius: 20px; text-align: center; font-weight: 700; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; transition: 0.3s; }
        
        /* Form Elements */
        input, select { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #edf2f7; border-radius: 12px; outline: none; box-sizing: border-box; font-family: 'Poppins'; }
        .btn { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 15px; }
        .btn:disabled { background: #ccc !important; cursor: not-allowed; }
        .back-btn { background: #fff; padding: 8px 18px; border-radius: 10px; cursor: pointer; display: inline-block; margin-bottom: 15px; font-weight: 600; border: 1px solid #ddd; }

        /* Instruction & Info Boxes */
        .info-box { text-align: left; background: #f0f3ff; padding: 15px; border-radius: 15px; font-size: 13px; line-height: 1.6; margin-bottom: 15px; border-left: 5px solid var(--primary); }
        .task-box { background: white; padding: 18px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #f0f0f0; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; }
        .reward-badge { background: #f0edff; color: var(--primary); padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: 700; display: inline-block; margin-bottom: 5px; }

        /* Spin Wheel */
        #wheel-container { position: relative; width: 280px; height: 280px; margin: 30px auto; }
        #pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 35px solid #ff4757; z-index: 10; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 10px solid #2d3436; transition: transform 5s cubic-bezier(0.1, 0, 0, 1); background: conic-gradient(#ff7675 0 72deg, #fdcb6e 72deg 144deg, #55efc4 144deg 216deg, #74b9ff 216deg 288deg, #a29bfe 288deg 360deg); position: relative; overflow: hidden; }
        .w-num { position: absolute; width: 100%; height: 100%; text-align: center; font-weight: 800; color: white; padding-top: 25px; font-size: 20px; }
        .n1 { transform: rotate(36deg); } .n2 { transform: rotate(108deg); } .n3 { transform: rotate(180deg); } .n4 { transform: rotate(252deg); } .n5 { transform: rotate(324deg); }

        /* History & Chat */
        .history-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee; }
        .status-badge { padding: 5px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-complete { background: #d4edda; color: #155724; }
        
        .chat-box { height: 280px; overflow-y: auto; background: #f9f9f9; padding: 15px; border-radius: 15px; display: flex; flex-direction: column; gap: 10px; border: 1px solid #eee; margin-bottom: 10px; }
        .msg { padding: 10px 15px; border-radius: 12px; max-width: 80%; font-size: 13px; }
        .msg.user { background: var(--primary); color: white; align-self: flex-end; }
        .msg.admin { background: #e9e9eb; color: #333; align-self: flex-start; }
        .proof-img { width: 100%; border-radius: 12px; margin-top: 10px; border: 1px solid #ddd; cursor: zoom-in; }
    </style>
</head>
<body>

<!-- AUTH PAGE -->
<div id="p-auth" class="page active">
    <div class="auth-card">
        <h2 id="auth-title">Welcome to Earn Pro</h2>
        <div id="reg-fields" style="display:none;"><input type="text" id="reg-name" placeholder="Full Name"></div>
        <input type="email" id="auth-email" placeholder="Email Address">
        <input type="password" id="auth-pass" placeholder="Password">
        <button class="btn" onclick="handleAuth()" id="auth-main-btn">Login</button>
        <p onclick="toggleAuth()" id="toggle-txt" style="margin-top:15px; cursor:pointer; font-weight:700; color:var(--primary);">Don't have an account? Register</p>
    </div>
</div>

<!-- DASHBOARD -->
<div id="p-dash" class="page">
    <div class="header">
        <h3 id="dash-user-name" style="margin:0;">User</h3>
        <div class="bal-row">
            <div class="bal-box">Wallet Balance<br><span class="pts-val" style="font-size:20px;">0</span> Pts</div>
            <div class="bal-box" style="background:var(--gold);">Ads Balance<br><span id="ads-val" style="font-size:20px;">0</span> Pts</div>
        </div>
    </div>
    <div class="grid">
        <div class="card" onclick="nav('p-available-tasks')">üåç Available Tasks</div>
        <div class="card" onclick="nav('p-spin')">üé° Spin Wheel</div>
        <div class="card" onclick="nav('p-daily')">üéØ 10 Tasks</div>
        <div class="card" onclick="nav('p-scratch')">‚ú® Scratch</div>
        <div class="card" onclick="nav('p-wa-task')" style="color:var(--wa);">üü¢ WA Task</div>
        <div class="card" onclick="nav('p-yt-task')" style="color:var(--yt);">üì∫ YouTube Task</div>
        <div class="card" onclick="nav('p-create-ad')">‚ûï Create Task</div>
        <div class="card" onclick="nav('p-my-tasks')">üìã My Ads & Proofs</div>
        <div class="card" onclick="nav('p-support')">üí¨ Support Chat</div>
        <div class="card" onclick="nav('p-withdraw')">üí∞ Withdraw</div>
        <div class="card" onclick="nav('p-deposit')">üí≥ Deposit</div>
        <div class="card" onclick="nav('p-promo')" style="background: #fff0f0; border: 1px dashed var(--danger);">üéÅ Promo Code</div>
        <div class="card" onclick="nav('p-refer')">üë• Refer Link</div>
        <div class="card" onclick="logout()" style="color:red;">üö™ Logout</div>
    </div>
</div>

<!-- WHATSAPP TASK PAGE -->
<div id="p-wa-task" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <h2 style="color:var(--wa);">üü¢ Official WhatsApp Channel</h2>
        <div class="info-box">
            <b>How to claim:</b><br>
            1. Click "JOIN NOW" to open the official channel.<br>
            2. Follow/Subscribe the channel.<br>
            3. Come back here and claim your reward.<br>
            <b>Reward:</b> 30 Points (Lifetime Once).
        </div>
        <button class="btn" onclick="openWaLink()" style="background:var(--wa);">JOIN NOW</button>
        <button id="wa-claim-btn" class="btn" onclick="claimWaReward()" style="margin-top:10px; background:#eee; color:#333;">Claim Join Reward</button>
    </div>
</div>

<!-- YOUTUBE TASK PAGE -->
<div id="p-yt-task" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <h2 style="color:var(--yt);">üì∫ Official YouTube Channel</h2>
        <div class="info-box">
            <b>How to claim:</b><br>
            1. Click "SUBSCRIBE" to open the channel.<br>
            2. Subscribe and press the Bell Icon.<br>
            3. Return and claim your points.<br>
            <b>Reward:</b> 20 Points (Lifetime Once).
        </div>
        <button class="btn" onclick="openYtLink()" style="background:var(--yt);">SUBSCRIBE NOW</button>
        <button id="yt-claim-btn" class="btn" onclick="claimYtReward()" style="margin-top:10px; background:#eee; color:#333;">Claim Subscribe Reward</button>
    </div>
</div>

<!-- CREATE AD PAGE -->
<div id="p-create-ad" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <h3 style="color:var(--danger); font-weight:700; margin-bottom:5px;">‚ö†Ô∏è CREATE THIS TASK ONLY DEPOSIT POINTS</h3>
        <div class="info-box">
            Create your own promotion! Select a platform, paste your link, and set a reward for workers. Points will be deducted from your <b>Ads Balance</b>.
        </div>
        <select id="task-platform">
            <option>YouTube</option><option>WhatsApp</option><option>TikTok</option>
            <option>Telegram</option><option>Instagram</option>
        </select>
        <input type="text" id="task-link" placeholder="Promotion Link (URL)">
        <input type="number" id="task-reward" placeholder="Reward per user (Points)">
        <input type="number" id="task-limit" placeholder="Total Workers (Limit)">
        <button class="btn" onclick="createNewTask()">Launch Promotion</button>
    </div>
</div>

<!-- WITHDRAW PAGE -->
<div id="p-withdraw" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <h3>üí∞ Withdrawal Center</h3>
        <script src="https://pl28633470.effectivegatecpm.com/48/59/08/4859083f886c1a09ed9a86ac9d282b9b.js"></script>
        <div class="info-box">
            <b>Your Balance:</b> <span class="pts-val">0</span> Pts<br>
            <b>Conversion:</b> 100 Pts = 10 PKR<br>
            <b>Minimum:</b> 3000 Points required to withdraw.
        </div>
        <select id="wit-method"><option>Easypaisa</option><option>JazzCash</option></select>
        <input type="text" id="wit-name" placeholder="Account Holder Name">
        <input type="number" id="wit-num" placeholder="Account Number">
        <input type="number" id="wit-pts" placeholder="Points to Withdraw">
        <button class="btn" onclick="submitWithdraw()">Submit Withdrawal</button>
        <h4 style="text-align:left; margin-top:25px;">Withdrawal History</h4>
        <div id="withdraw-history"></div>
    </div>
</div>

<!-- DEPOSIT PAGE -->
<div id="p-deposit" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <h3>üí≥ Deposit for Ads</h3>
        <div class="info-box">
            <b>Rate:</b> 500 PKR = 2500 Ads Pts<br>
            <b>Easypaisa:</b> 03019016682<br>
            <b>Name:</b> TEHSIN ULLAH<br>
            <b>Note:</b> After sending payment, enter the Amount and TID below.
        </div>
        <input type="number" id="dep-amount" placeholder="Amount (PKR)">
        <input type="text" id="dep-tid" placeholder="Transaction ID (TID)">
        <button class="btn" onclick="submitDeposit()">Submit Deposit</button>
        <h4 style="text-align:left; margin-top:25px;">Deposit History</h4>
        <div id="deposit-history"></div>
    </div>
</div>

<!-- AVAILABLE TASKS (GLOBAL) -->
<div id="p-available-tasks" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <script src="https://pl28633470.effectivegatecpm.com/48/59/08/4859083f886c1a09ed9a86ac9d282b9b.js"></script>
    <h3>üåç Earning Task Channel</h3>
    <div class="info-box">Complete tasks below and send a clear screenshot. Each task can only be completed <b>ONCE</b>. Spamming will result in a ban.</div>
    <div id="global-task-list"></div>
</div>

<!-- MY ADS PROOFS -->
<div id="p-my-tasks" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <h3>üìã Manage My Ads & Workers</h3>
    <div id="my-ads-list"></div>
</div>

<!-- SPIN WHEEL -->
<div id="p-spin" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <center>
        <div id="wheel-container">
            <div id="pointer"></div>
            <div id="wheel">
                <div class="w-num n1">10</div><div class="w-num n2">50</div>
                <div class="w-num n3">5</div><div class="w-num n4">20</div>
                <div class="w-num n5">100</div>
            </div>
        </div>
        <button id="spin-btn" class="btn" onclick="runSpin()" style="width:200px;">SPIN</button>
        <h3 id="spin-status" style="color:var(--danger); display:none; margin-top:20px;">Used today. Come back tomorrow!</h3>
    </center>
    <script src="https://pl28633470.effectivegatecpm.com/48/59/08/4859083f886c1a09ed9a86ac9d282b9b.js"></script>
</div>

<!-- SUPPORT CHAT -->
<div id="p-support" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <script src="https://pl28633470.effectivegatecpm.com/48/59/08/4859083f886c1a09ed9a86ac9d282b9b.js"></script>
        <h3>üí¨ Admin Support Chat</h3>
        <div id="chat-display" class="chat-box"></div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="chat-input" placeholder="Type your message..." style="margin:0;">
            <button class="btn" onclick="sendChatMessage()" style="width:80px; padding:0;">Send</button>
        </div>
    </div>
</div>

<!-- OTHER PAGES -->
<div id="p-daily" class="page"><div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div><h3>üéØ Daily 10 Tasks</h3><div id="daily-list"></div></div>
<div id="p-scratch" class="page"><div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div><h3>‚ú® Daily 10 Scratches</h3><div class="grid" id="scratch-grid"></div></div>
    <script src="https://pl28633470.effectivegatecpm.com/48/59/08/4859083f886c1a09ed9a86ac9d282b9b.js"></script>
<div id="p-promo" class="page"><div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div><div class="auth-card"><h3>üéÅ Use Promo Code</h3><input id="promo-input" placeholder="Enter Gift Code"><button class="btn" onclick="redeemPromo()">Redeem Now</button></div></div>
<div id="p-refer" class="page"><div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div><div class="auth-card"><h3>üë• Your Refer Link</h3><div id="full-ref-link" style="word-break:break-all; background:#f4f4f4; padding:15px; border-radius:15px; font-size:12px; margin-bottom:15px;"></div><button class="btn" onclick="copyReferLink()">Copy Link</button><p style="font-size:12px; color:gray; margin-top:15px;">Invite friends and get <b>30 Points</b> reward!</p></div></div>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyAu-upMoRa9ZmDF6y2w7CQFGvsJuD4XD5w",
        authDomain: "app1-1192c.firebaseapp.com",
        databaseURL: "https://app1-1192c-default-rtdb.firebaseio.com",
        projectId: "app1-1192c",
        storageBucket: "app1-1192c.firebasestorage.app",
        messagingSenderId: "69763506208",
        appId: "1:69763506208:web:9cdbe12237d9a1abc71c45"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(), auth = firebase.auth();

    let uID = null, uData = {}, isRegister = false;

    // --- INITIALIZATION ---
    auth.onAuthStateChanged(user => {
        if(user) {
            uID = user.uid;
            db.ref('users/' + uID).on('value', snap => {
                uData = snap.val() || {};
                checkMidnightReset();
                updateUI();
                loadHistory();
                loadChat();
                loadGlobalTasks();
                loadMyTasks();
                initEarningTasks();
            });
            nav('p-dash');
        } else { nav('p-auth'); }
    });

    // --- LOGIC: MIDNIGHT RESET ---
    function checkMidnightReset() {
        const today = new Date().toDateString();
        if(uData.lastResetDate !== today) {
            db.ref('users/' + uID).update({
                lastResetDate: today,
                scratches: {},
                daily: {},
                lastSpin: ""
            });
        }
    }

    function updateUI() {
        document.querySelectorAll('.pts-val').forEach(el => el.innerText = uData.points || 0);
        document.getElementById('ads-val').innerText = uData.depPoints || 0;
        document.getElementById('dash-user-name').innerText = "Hi, " + (uData.name || "User");
        document.getElementById('full-ref-link').innerText = window.location.origin + window.location.pathname + "?ref=" + (uData.refCode || "");
        
        const today = new Date().toDateString();
        if(uData.lastSpin === today) {
            document.getElementById('spin-btn').style.display = 'none';
            document.getElementById('spin-status').style.display = 'block';
        } else {
            document.getElementById('spin-btn').style.display = 'block';
            document.getElementById('spin-status').style.display = 'none';
        }
        if(uData.waClaimed) document.getElementById('wa-claim-btn').disabled = true;
        if(uData.ytClaimed) document.getElementById('yt-claim-btn').disabled = true;
    }

    // --- LOGIC: GLOBAL TASKS (ANTI-SPAM) ---
    function loadGlobalTasks() {
        db.ref('user_tasks').on('value', snap => {
            let h = "";
            snap.forEach(c => {
                const t = c.val();
                const tid = c.key;
                const alreadyDone = uData.completedTasks && uData.completedTasks[tid];

                if(t.creator !== uID && (t.completedCount || 0) < t.limit) {
                    h += `<div class="task-box">
                        <span class="reward-badge">${t.reward} Pts</span><br>
                        <b>${t.type} Promotion</b><br>
                        ${alreadyDone ? 
                            `<button class="btn" disabled style="background:var(--success);">Submitted ‚úÖ</button>` : 
                            `<button class="btn" style="width:100px; padding:6px; margin-top:5px;" onclick="window.open('${t.link}')">Open</button>
                             <button class="btn" style="width:120px; padding:6px; margin-top:5px; background:var(--gold);" onclick="triggerUpload('${tid}')">Send Proof</button>`
                        }
                    </div>`;
                }
            });
            document.getElementById('global-task-list').innerHTML = h || "No tasks available.";
        });
    }

    function triggerUpload(tid) {
        const input = document.createElement('input');
        input.type = 'file'; input.accept = 'image/*';
        input.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = async () => {
                await db.ref('task_proofs/' + tid + '/' + uID).set({
                    workerName: uData.name,
                    workerEmail: uData.email,
                    img: reader.result,
                    time: Date.now()
                });
                await db.ref('users/' + uID + '/completedTasks/' + tid).set(true);
                alert("Proof submitted! Reward after approval.");
            };
            reader.readAsDataURL(file);
        };
        input.click();
    }

    // --- LOGIC: MY ADS & PROOFS ---
    function loadMyTasks() {
        db.ref('user_tasks').on('value', snap => {
            let h = "";
            snap.forEach(c => {
                if(c.val().creator === uID) {
                    const tid = c.key;
                    h += `<div class="task-box">
                        <b>My ${c.val().type} Ad</b> (${c.val().completedCount}/${c.val().limit})<br>
                        <div id="proofs-${tid}"></div>
                        <button class="btn" style="background:var(--danger); padding:6px; font-size:11px; margin-top:10px;" onclick="deleteAd('${tid}')">Delete Ad</button>
                    </div>`;
                    loadProofs(tid, c.val().reward);
                }
            });
            document.getElementById('my-ads-list').innerHTML = h || "No ads launched.";
        });
    }

    function loadProofs(tid, reward) {
        db.ref('task_proofs/' + tid).on('value', snap => {
            const div = document.getElementById('proofs-' + tid);
            if(!div) return; div.innerHTML = "";
            snap.forEach(p => {
                const d = p.val();
                const workerUID = p.key;
                div.innerHTML += `<div style="border:1px solid #eee; padding:12px; border-radius:12px; margin-top:10px; background:#fafafa;">
                    <div style="font-size:12px; margin-bottom:5px;">
                        <b>Worker:</b> ${d.workerName}<br><b>Email:</b> ${d.workerEmail}
                    </div>
                    <img src="${d.img}" class="proof-img" onclick="window.open(this.src)">
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button class="btn" style="background:var(--success); padding:6px; font-size:12px;" onclick="approveProof('${tid}','${workerUID}',${reward})">Approve</button>
                        <button class="btn" style="background:var(--danger); padding:6px; font-size:12px;" onclick="rejectProof('${tid}','${workerUID}')">Reject</button>
                    </div>
                </div>`;
            });
        });
    }

    async function approveProof(tid, workerUID, reward) {
        await db.ref('users/' + workerUID + '/points').transaction(v => (v || 0) + reward);
        await db.ref('user_tasks/' + tid + '/completedCount').transaction(v => (v || 0) + 1);
        await db.ref('task_proofs/' + tid + '/' + workerUID).remove();
        alert("Worker Paid!");
    }
    async function rejectProof(tid, workerUID) { await db.ref('task_proofs/' + tid + '/' + workerUID).remove(); alert("Rejected."); }
    async function deleteAd(tid) { if(confirm("Delete Ad?")) { await db.ref('user_tasks/'+tid).remove(); await db.ref('task_proofs/'+tid).remove(); } }

    // --- LOGIC: AUTH & REFER ---
    async function handleAuth() {
        const email = document.getElementById('auth-email').value, pass = document.getElementById('auth-pass').value;
        const refBy = new URLSearchParams(window.location.search).get('ref');
        try {
            if(isRegister) {
                const name = document.getElementById('reg-name').value;
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                const refCode = "PM" + Math.floor(1000 + Math.random() * 9000);
                await db.ref('users/' + res.user.uid).set({ name, email, points: 50, depPoints: 0, refCode, referredBy: refBy || null, lastResetDate: new Date().toDateString() });
                if(refBy) {
                    db.ref('users').orderByChild('refCode').equalTo(refBy).once('value', s => {
                        s.forEach(c => { db.ref('users/'+c.key+'/points').transaction(p => (p||0)+30); });
                    });
                }
            } else { await auth.signInWithEmailAndPassword(email, pass); }
        } catch(e) { alert(e.message); }
    }

    // --- GAMES ---
    async function runSpin() {
        const wheel = document.getElementById('wheel');
        wheel.style.transform = `rotate(${3600 + 72}deg)`;
        document.getElementById('spin-btn').disabled = true;
        setTimeout(async () => {
            await db.ref('users/'+uID+'/points').transaction(v=>(v||0)+10);
            await db.ref('users/'+uID+'/lastSpin').set(new Date().toDateString());
            alert("10 Points Added!");
        }, 5000);
    }

    function initEarningTasks() {
        const sg = document.getElementById('scratch-grid'); sg.innerHTML = "";
        for(let i=1; i<=10; i++) sg.innerHTML += `<div class="card" onclick="doScratch(this, ${i})">${uData.scratches && uData.scratches[i] ? '‚úì' : '+5 Pts'}</div>`;
        const dl = document.getElementById('daily-list'); dl.innerHTML = "";
        for(let i=1; i<=10; i++) dl.innerHTML += `<div class="task-box">Daily Task #${i} ${uData.daily && uData.daily[i] ? '‚úÖ' : `<button class="btn" style="width:80px; padding:5px; margin-top:5px;" onclick="doDaily(this, ${i})">Claim</button>`}</div>`;
    }
    async function doScratch(el, id) { if(!uData.scratches || !uData.scratches[id]) { await db.ref('users/'+uID+'/points').transaction(v=>(v||0)+5); await db.ref('users/'+uID+'/scratches/'+id).set(true); } }
    async function doDaily(btn, id) { await db.ref('users/'+uID+'/points').transaction(v=>(v||0)+5); await db.ref('users/'+uID+'/daily/'+id).set(true); }

    // --- CORE TX ---
    async function submitWithdraw() {
        const pts = parseInt(document.getElementById('wit-pts').value);
        if(pts < 3000 || (uData.points || 0) < pts) return alert("Min 3000 Points!");
        await db.ref('users/'+uID+'/points').transaction(v => v - pts);
        await db.ref('withdraws').push({ uID, pts, name: document.getElementById('wit-name').value, num: document.getElementById('wit-num').value, method: document.getElementById('wit-method').value, status: 'pending', time: Date.now() });
        alert("Withdrawal Requested!");
    }
    async function submitDeposit() {
        const amt = parseInt(document.getElementById('dep-amount').value), tid = document.getElementById('dep-tid').value;
        if(amt < 500 || !tid) return alert("Min 500 PKR & TID!");
        await db.ref('deposits').push({ uID, amount: amt, tid, status: 'pending', time: Date.now() });
        alert("Deposit Submitted!");
    }
    function loadHistory() {
        db.ref('deposits').orderByChild('uID').equalTo(uID).on('value', s => { let h = ""; s.forEach(c => { const d = c.val(); h += `<div class="history-item"><div>Rs ${d.amount}</div><span class="status-badge status-${d.status}">${d.status}</span></div>`; }); document.getElementById('deposit-history').innerHTML = h || "No History"; });
        db.ref('withdraws').orderByChild('uID').equalTo(uID).on('value', s => { let h = ""; s.forEach(c => { const w = c.val(); h += `<div class="history-item"><div>${w.pts} Pts</div><span class="status-badge status-${w.status}">${w.status}</span></div>`; }); document.getElementById('withdraw-history').innerHTML = h || "No History"; });
    }

    // --- OTHER ---
    function openWaLink() { db.ref('settings/waLink').once('value', s => { if(s.exists()) window.open(s.val(), '_blank'); }); }
    function openYtLink() { db.ref('settings/ytLink').once('value', s => { if(s.exists()) window.open(s.val(), '_blank'); }); }
    async function claimWaReward() { if(!uData.waClaimed) { await db.ref('users/'+uID+'/points').transaction(v=>(v||0)+30); await db.ref('users/'+uID+'/waClaimed').set(true); alert("30 Pts Claimed!"); } }
    async function claimYtReward() { if(!uData.ytClaimed) { await db.ref('users/'+uID+'/points').transaction(v=>(v||0)+20); await db.ref('users/'+uID+'/ytClaimed').set(true); alert("20 Pts Claimed!"); } }
    async function createNewTask() {
        const r = parseInt(document.getElementById('task-reward').value), l = parseInt(document.getElementById('task-limit').value);
        if((uData.depPoints || 0) < (r*l)) return alert("Low Ads Balance!");
        await db.ref('users/'+uID+'/depPoints').transaction(v => v - (r*l));
        await db.ref('user_tasks').push({ creator: uID, type: document.getElementById('task-platform').value, link: document.getElementById('task-link').value, reward: r, limit: l, completedCount: 0 });
        alert("Promotion Launched!"); nav('p-dash');
    }
    async function redeemPromo() {
        const code = document.getElementById('promo-input').value.trim().toUpperCase();
        db.ref('promos').orderByChild('code').equalTo(code).once('value', async s => {
            if(!s.exists()) return alert("Invalid Code");
            let pk, pd; s.forEach(c => { pk=c.key; pd=c.val(); });
            if(uData.usedPromos && uData.usedPromos[pk]) return alert("Used");
            if((pd.usedCount || 0) >= pd.limit) return alert("Expired");
            await db.ref('users/'+uID+'/points').transaction(v=>(v||0)+pd.pts);
            await db.ref('promos/'+pk+'/usedCount').transaction(c=>(c||0)+1);
            await db.ref('users/'+uID+'/usedPromos/'+pk).set(true);
            alert("Success!");
        });
    }
    function sendChatMessage() { const m = document.getElementById('chat-input').value; if(m) { db.ref('chats/'+uID).push({ sender: 'user', msg: m, time: Date.now() }); document.getElementById('chat-input').value = ""; } }
    function loadChat() { db.ref('chats/'+uID).on('value', s => { let h = ""; s.forEach(c => { const m = c.val(); h += `<div class="msg ${m.sender}">${m.msg}</div>`; }); const d = document.getElementById('chat-display'); d.innerHTML = h; d.scrollTop = d.scrollHeight; }); }
    function nav(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function toggleAuth() { isRegister = !isRegister; document.getElementById('reg-fields').style.display = isRegister ? 'block' : 'none'; document.getElementById('auth-title').innerText = isRegister ? "Register" : "Login"; }
    function logout() { auth.signOut().then(() => location.reload()); }
    function copyReferLink() { navigator.clipboard.writeText(document.getElementById('full-ref-link').innerText); alert("Copied!"); }
</script> 
 <script src="https://pl28644443.effectivegatecpm.com/c0/57/f2/c057f2afc18ec40a930f23339db6ab9a.js"></script>
    <!-- 1) Naya Task Page (HTML) -->
<div id="p-click-task" class="page">
    <div class="back-btn" onclick="nav('p-dash')">‚¨Ö Back</div>
    <div class="auth-card">
        <h3>üëÜ Lifetime Click Challenge</h3>
        <div id="click-area-box">
            <p>Button par 100 baar click karein aur 200 Points hasil karein. (Ye task sirf 1 baar hoga)</p>
            <h2 id="c-count" style="font-size: 50px; color: #6c5ce7; margin: 10px 0;">0</h2>
            <div style="width: 100%; background: #eee; height: 12px; border-radius: 10px; margin-bottom: 20px; overflow: hidden;">
                <div id="c-pro" style="width: 0%; height: 100%; background: #2ecc71; transition: 0.1s;"></div>
            </div>
            <button id="c-btn-main" onclick="doClick()" style="width: 130px; height: 130px; border-radius: 50%; background: #6c5ce7; color: white; border: 6px solid #eee; font-weight: 800; cursor: pointer; box-shadow: 0 6px 0 #4834d4; outline: none; transition: 0.1s;">CLICK</button>
        </div>
        <div id="c-done-msg" style="display:none; text-align: center;">
            <div style="font-size: 50px;">‚úÖ</div>
            <h3 style="color: #2ecc71;">Task Completed!</h3>
            <p>Aapne 200 Points pehle hi hasil kar liye hain.</p>
            <button class="btn" onclick="nav('p-dash')">Go Back</button>
        </div>
    </div>
</div>
    
</script>
</body>
</html>
